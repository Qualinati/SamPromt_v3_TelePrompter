<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> SamPrompt The Architect </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Merriweather:wght@300;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'], 
                        serif: ['Merriweather', 'serif'], 
                        mono: ['JetBrains Mono', 'monospace'] 
                    },
                    colors: {
                        accent: { DEFAULT: '#F59E0B', hover: '#D97706' }, // Amber-500
                        darkbg: '#050505', 
                        panel: '#101010',
                        toolbar: '#1a1a1a'
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --font-size: 5rem;
            --line-height: 1.5;
            --focus-height: 220px;
            --container-width: 80%;
        }

        body { 
            background-color: #050505; 
            overflow: hidden; 
            color: #e5e5e5;
        }

        /* --- UI CUSTOMIZATION --- */
        input[type=range] { -webkit-appearance: none; background: transparent; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%; background: #F59E0B; margin-top: -5px; box-shadow: 0 0 10px rgba(245,158,11,0.5);
        }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #333; border-radius: 2px; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* --- EDITOR STYLES (GOOGLE DOCS FEEL) --- */
        .editor-container {
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex; flex-direction: column;
            height: calc(100vh - 140px); /* Responsive Height */
            max-width: 95%; margin: 0 auto;
        }

        .editor-toolbar {
            background-color: #222;
            border-bottom: 1px solid #333;
            padding: 10px 20px;
            display: flex; gap: 8px; align-items: center;
            flex-wrap: wrap;
        }

        .editor-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            font-family: 'Inter', sans-serif;
            font-size: 1.2rem;
            line-height: 1.6;
            color: #ddd;
            outline: none;
        }
        
        /* Edit√∂r ƒ∞√ßi Formatlama */
        .editor-content h1 { font-size: 2em; font-weight: bold; margin-bottom: 0.5em; color: #fff; }
        .editor-content h2 { font-size: 1.5em; font-weight: bold; margin-bottom: 0.5em; color: #ccc; }
        .editor-content ul { list-style-type: disc; padding-left: 20px; margin-bottom: 1em; }
        .editor-content ol { list-style-type: decimal; padding-left: 20px; margin-bottom: 1em; }
        .editor-content b { color: #F59E0B; } /* Kalƒ±nlar hafif sarƒ± olsun edit√∂rde */

        /* --- PROMPTER ENGINE STYLES --- */
        #prompter-overlay {
            position: fixed; inset: 0; background: #000; z-index: 100;
            display: none; /* Ba≈ülangƒ±√ßta gizli */
        }

        /* Bu kapsayƒ±cƒ± sabit durur */
        #prompter-viewport {
            width: 100%; height: 100vh;
            overflow: hidden; position: relative;
        }

        /* Bu katman transform ile kayar (GPU Hƒ±zlandƒ±rma) */
        #prompter-content {
            width: var(--container-width);
            margin: 0 auto;
            text-align: center;
            padding-bottom: 50vh; /* Altta bo≈üluk */
            will-change: transform;
            /* Ba≈ülangƒ±√ß paddingi JS ile verilecek */
        }

        .word {
            display: inline-block;
            font-size: var(--font-size);
            line-height: var(--line-height);
            font-weight: 700;
            color: rgba(255, 255, 255, 0.25); /* Pasif kelime rengi */
            filter: blur(1px); /* Pasif blur */
            transition: color 0.2s, filter 0.2s, opacity 0.2s;
            margin-right: 0.25em;
            margin-bottom: 0.25em;
        }

        .word.active {
            color: #F59E0B !important; /* Altƒ±n Sarƒ±sƒ± */
            filter: blur(0) !important;
            opacity: 1 !important;
            transform: scale(1.05);
            text-shadow: 0 0 30px rgba(245, 158, 11, 0.6);
        }

        /* Odak Alanƒ± i√ßindeki kelimeler (Netle≈üir) */
        .word.in-focus {
            color: #ffffff;
            filter: blur(0);
            opacity: 0.9;
        }

        /* --- ODAK BANDI --- */
        .focus-band {
            position: fixed; top: 40%; left: 0; right: 0;
            height: var(--focus-height);
            transform: translateY(-50%);
            border-top: 2px solid rgba(245, 158, 11, 0.3);
            border-bottom: 2px solid rgba(245, 158, 11, 0.3);
            background: linear-gradient(to bottom, rgba(245,158,11,0.02), transparent);
            pointer-events: none; z-index: 10;
        }
        
        .mirror-x { transform: scaleX(-1); }
    </style>
</head>
<body>

    <header class="h-20 bg-darkbg border-b border-white/10 flex items-center justify-between px-8 relative z-50">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-accent rounded flex items-center justify-center text-black font-black text-2xl shadow-[0_0_15px_rgba(245,158,11,0.4)]">S</div>
            <div>
                <h1 class="text-white font-bold text-lg leading-none">SamPrompt</h1>
                <span class="text-xs text-accent font-bold tracking-widest">V26 ARCHITECT</span>
            </div>
        </div>
        
        <div class="flex items-center gap-4">
            <div class="hidden md:flex flex-col items-end mr-2">
                <span class="text-[0.6rem] text-gray-500 uppercase tracking-widest">LC WAIKIKI KURUMSAL AKADEMƒ∞</span>
            </div>
            <button onclick="toggleAbout()" class="px-4 py-2 border border-white/20 text-gray-300 rounded hover:bg-white/10 transition text-sm font-bold">HAKKINDA</button>
        </div>
    </header>

    <main class="p-6">
        <div class="editor-container">
            <div class="editor-toolbar">
                <button onclick="format('bold')" class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded font-bold" title="Kalƒ±n">B</button>
                <button onclick="format('italic')" class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded italic" title="ƒ∞talik">I</button>
                <button onclick="format('underline')" class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded underline" title="Altƒ± √áizili">U</button>
                <div class="w-px h-6 bg-white/20 mx-2"></div>
                <button onclick="format('justifyLeft')" class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded" title="Sola">SOL</button>
                <button onclick="format('justifyCenter')" class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded" title="Ortala">ORTA</button>
                <div class="w-px h-6 bg-white/20 mx-2"></div>
                <button onclick="format('insertUnorderedList')" class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded" title="Liste">‚Ä¢ Liste</button>
                <button onclick="format('formatBlock', 'H2')" class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded font-bold" title="Ba≈ülƒ±k">H1</button>
                
                <div class="flex-1"></div>
                <div class="relative">
                    <input type="text" id="search-box" placeholder="Metinde ara..." onkeyup="searchText(this.value)" class="bg-black/50 border border-white/20 rounded-full px-4 py-1 text-sm text-white focus:border-accent outline-none w-48">
                </div>
                <div class="w-px h-6 bg-white/20 mx-2"></div>
                <button onclick="saveText()" class="text-xs text-accent border border-accent/50 px-3 py-1 rounded hover:bg-accent/10 transition" id="save-btn">KAYDET</button>
            </div>

            <div id="editor" class="editor-content" contenteditable="true" spellcheck="false"></div>

            <div class="bg-[#111] p-4 border-t border-white/10 flex justify-end">
                <button onclick="startPrompter()" class="bg-accent hover:bg-yellow-500 text-black font-extrabold text-lg px-10 py-3 rounded shadow-lg hover:scale-105 transition flex items-center gap-2">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    BA≈ûLAT (PROMPT IT!)
                </button>
            </div>
        </div>
    </main>

    <div id="prompter-overlay">
        
        <div id="control-panel" class="absolute top-0 left-0 right-0 bg-black/90 border-b border-white/10 p-4 z-50 transform transition-transform duration-300 translate-y-0">
            <div class="flex items-center justify-between gap-8 container mx-auto">
                
                <div class="flex items-center gap-6 overflow-x-auto no-scrollbar">
                    <div class="flex flex-col w-32">
                        <label class="text-[0.6rem] text-gray-400 font-bold mb-1 flex justify-between">BOYUT <span id="val-font">5.0</span></label>
                        <input type="range" min="2" max="10" step="0.2" value="5" oninput="setProp('--font-size', this.value + 'rem', 'val-font')">
                    </div>
                    <div class="flex flex-col w-32">
                        <label class="text-[0.6rem] text-gray-400 font-bold mb-1 flex justify-between">GENƒ∞≈ûLƒ∞K <span id="val-width">80%</span></label>
                        <input type="range" min="30" max="100" step="5" value="80" oninput="setProp('--container-width', this.value + '%', 'val-width')">
                    </div>
                    <div class="flex flex-col w-32">
                        <label class="text-[0.6rem] text-gray-400 font-bold mb-1 flex justify-between">ARALIK <span id="val-line">1.5</span></label>
                        <input type="range" min="1" max="3" step="0.1" value="1.5" oninput="setProp('--line-height', this.value, 'val-line')">
                    </div>
                    <div class="flex flex-col w-32">
                        <label class="text-[0.6rem] text-amber-500 font-bold mb-1 flex justify-between">ODAK ALANI <span id="val-focus">220px</span></label>
                        <input type="range" min="100" max="500" step="10" value="220" oninput="setProp('--focus-height', this.value + 'px', 'val-focus')">
                    </div>
                </div>

                <div class="flex gap-4">
                    <button onclick="toggleMirror()" class="text-xs bg-white/10 px-3 py-2 rounded text-white border border-white/20 hover:bg-white/20" id="btn-mirror">AYNA</button>
                    <button onclick="document.getElementById('control-panel').classList.add('-translate-y-full')" class="text-gray-500 hover:text-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg></button>
                </div>
            </div>
        </div>
        
        <div class="absolute top-0 left-0 right-0 h-4 z-40 hover:bg-accent/10 cursor-pointer" onmouseover="document.getElementById('control-panel').classList.remove('-translate-y-full')"></div>

        <div class="focus-band"></div>

        <div class="absolute top-24 right-10 text-right z-30 pointer-events-none">
            <div id="hud-status" class="text-4xl font-black text-accent drop-shadow-lg opacity-80">HAZIR</div>
            <div id="hud-speed" class="text-sm font-mono text-gray-400 mt-1">HIZ: 0</div>
        </div>

        <div id="prompter-viewport">
            <div id="prompter-content">
                </div>
        </div>

        <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 flex items-center gap-6 bg-black/80 px-8 py-3 rounded-full border border-white/10 backdrop-blur z-50">
            <button onclick="exitPrompter()" class="text-gray-400 hover:text-red-500 transition"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
            <div class="w-px h-6 bg-white/20"></div>
            <button id="btn-mic" onclick="toggleVoiceMode()" class="p-3 bg-white/10 rounded-full text-white hover:bg-white/20 transition"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/></svg></button>
            <button id="btn-play" onclick="togglePlay()" class="p-3 bg-accent rounded-full text-black hover:scale-110 transition shadow-lg"><svg id="icon-play" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button>
            <div class="w-px h-6 bg-white/20"></div>
            <button onclick="resetPosition()" class="text-gray-400 hover:text-white transition"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg></button>
        </div>

    </div>

    <div id="modal-about" class="fixed inset-0 bg-black/90 z-[100] hidden flex items-center justify-center backdrop-blur-sm" onclick="this.classList.add('hidden')">
        <div class="bg-[#111] p-8 rounded-2xl border border-accent/20 max-w-md text-center shadow-2xl" onclick="event.stopPropagation()">
            <div class="text-4xl mb-4">üöÄ</div>
            <h2 class="text-2xl font-bold text-white mb-2">SamPrompt V26</h2>
            <p class="text-accent text-xs font-bold tracking-widest mb-6">THE ARCHITECT EDITION</p>
            <p class="text-gray-400 text-sm mb-4">Bu s√ºr√ºm, en p√ºr√ºzs√ºz akƒ±≈ü deneyimi i√ßin GPU hƒ±zlandƒ±rmalƒ± fizik motoru kullanƒ±r.</p>
            <div class="text-left bg-black/50 p-4 rounded text-xs text-gray-300 space-y-2">
                <p>üéôÔ∏è <strong>SES:</strong> Konu≈ütuk√ßa metin akar, durursan yava≈ülar.</p>
                <p>üñ±Ô∏è <strong>MANUEL:</strong> Fare tekerleƒüi veya W/S tu≈ülarƒ± hƒ±zƒ± ayarlar.</p>
                <p>üéπ <strong>KISAYOL:</strong> + / - ile odak alanƒ±nƒ± deƒüi≈ütir.</p>
            </div>
            <button onclick="document.getElementById('modal-about').classList.add('hidden')" class="mt-6 text-sm text-gray-500 hover:text-white">Kapat</button>
        </div>
    </div>

    <script>
        // === 1. CONFIG & STATE ===
        const STORAGE_KEY = 'samPrompt_V26_Architect';
        const DEFAULT_HTML = `
            <h1>SamPrompt Teleprompter‚Äôa ho≈ü geldin!</h1>
            <p><i>Bir hik√¢ye anlatmaya hazƒ±r mƒ±sƒ±n?</i></p>
            <br>
            <p>"SamPrompt Teleprompter", herkesin kullanabileceƒüi, en kapsamlƒ±, √ºcretsiz, profesyonel ve <b>Lc Waikiki Kurumsal Akademi Eƒüitim Teknolojileri M√ºd√ºrl√ºƒü√º</b> i√ßin <b>Samet Sevgili</b> tarafƒ±ndan olu≈üturulmu≈ü teleprompter yazƒ±lƒ±mƒ±dƒ±r.</p>
            <br>
            <h2>√ñzellikler:</h2>
            <ul>
                <li><b>Akƒ±llƒ± Ses Takibi:</b> Siz okuduk√ßa metin otomatik akar.</li>
                <li><b>P√ºr√ºzs√ºz Kaydƒ±rma:</b> Takƒ±lma yok, titreme yok.</li>
                <li><b>Odak Kilidi:</b> Sadece okuduƒüunuz satƒ±r netle≈üir.</li>
            </ul>
            <br>
            <p>Hazƒ±r olduƒüunda a≈üaƒüƒ±daki <b>BA≈ûLAT</b> butonuna tƒ±kla!</p>
        `;

        let state = {
            isPlaying: false,
            isVoiceMode: false,
            scrollSpeed: 0, // Piksel/Frame (Manuel Mod)
            currentY: 0,    // Mevcut konum (px)
            targetY: 0,     // Hedef konum (px)
            words: [],      // Kelime elementleri ve datalarƒ±
            recognition: null,
            lastFrameTime: 0,
            isMirrored: false
        };

        // === 2. INIT & EDITOR ===
        const editor = document.getElementById('editor');
        
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem(STORAGE_KEY);
            editor.innerHTML = saved || DEFAULT_HTML;
        });

        function format(cmd, val=null) { document.execCommand(cmd, false, val); editor.focus(); }
        function saveText() { 
            localStorage.setItem(STORAGE_KEY, editor.innerHTML); 
            const btn = document.getElementById('save-btn');
            btn.textContent = "KAYDEDƒ∞LDƒ∞ ‚úì";
            setTimeout(() => btn.textContent = "KAYDET", 2000);
        }
        function searchText(term) {
            if(!term) return;
            window.find(term, false, false, true, false, true, false);
        }
        function toggleAbout() { document.getElementById('modal-about').classList.remove('hidden'); }

        // === 3. PROMPTER ENGINE (THE CORE) ===
        const overlay = document.getElementById('prompter-overlay');
        const contentDiv = document.getElementById('prompter-content');
        
        function startPrompter() {
            const rawHTML = editor.innerHTML;
            if(!editor.innerText.trim()) return alert("L√ºtfen metin girin.");

            // Metni ƒ∞≈üleme (Parsing)
            // HTML'i koruyarak kelimeleri span i√ßine alma i≈ülemi zorlu bir i≈ütir.
            // V26'da basitle≈ütirilmi≈ü bir yakla≈üƒ±m kullanacaƒüƒ±z:
            // HTML yapƒ±sƒ±nƒ± koru, sadece text node'larƒ± kelimelere b√∂l.
            
            contentDiv.innerHTML = processHTML(rawHTML);
            
            // Kelime haritasƒ± olu≈ütur
            state.words = Array.from(document.querySelectorAll('.word')).map(el => ({
                el: el,
                clean: el.innerText.toLowerCase().replace(/[^\w√ßƒüƒ±√∂≈ü√º]/g, ''),
                top: 0 // Sonra hesaplanacak
            }));

            overlay.style.display = 'block';
            resetPosition();
            
            // Ba≈ülangƒ±√ß Padding (Ortalama)
            updatePadding();
            
            // Loop Ba≈ülat
            state.lastFrameTime = performance.now();
            requestAnimationFrame(gameLoop);
        }

        // HTML Node Walker (Kelimeleri span'la sarmalar)
        function processHTML(html) {
            const div = document.createElement('div');
            div.innerHTML = html;
            
            function walk(node) {
                if (node.nodeType === 3) { // Text Node
                    const text = node.nodeValue;
                    if (text.trim().length === 0) return;
                    
                    const newHtml = text.replace(/([^\s]+)/g, '<span class="word">$1</span>');
                    const spanWrapper = document.createElement('span');
                    spanWrapper.innerHTML = newHtml;
                    node.parentNode.replaceChild(spanWrapper, node);
                } else if (node.nodeType === 1 && !node.classList.contains('word')) {
                    Array.from(node.childNodes).forEach(walk);
                }
            }
            walk(div);
            return div.innerHTML;
        }

        function exitPrompter() {
            state.isPlaying = false;
            state.isVoiceMode = false;
            if(state.recognition) state.recognition.stop();
            overlay.style.display = 'none';
        }

        // === 4. PHYSICS LOOP (OYUN MOTORU) ===
        function gameLoop(timestamp) {
            if(overlay.style.display === 'none') return;

            // Delta Time (Frame s√ºresi farkƒ±)
            // const dt = timestamp - state.lastFrameTime;
            state.lastFrameTime = timestamp;

            // --- MANUEL MOD ---
            if(state.isPlaying && !state.isVoiceMode) {
                // Hƒ±z varsa ilerle
                state.targetY += state.scrollSpeed;
                state.currentY = state.targetY;
            }

            // --- SESLƒ∞ MOD (SMOOTH DAMPING) ---
            if(state.isVoiceMode) {
                // targetY = Aktif kelimenin konumu
                // currentY = Ekranƒ±n konumu
                // Farkƒ± al ve %5'ini ekle (Lerp)
                const diff = state.targetY - state.currentY;
                
                if(Math.abs(diff) > 0.5) {
                    // Mesafe uzaksa hƒ±zlan, yakƒ±nsa yava≈üla
                    // √áok gerideyse (diff > 500) daha hƒ±zlƒ± gel
                    const speedFactor = Math.abs(diff) > 500 ? 0.1 : 0.04;
                    state.currentY += diff * speedFactor;
                }
            }

            // GPU Render
            contentDiv.style.transform = `translateY(${-state.currentY}px)`;

            // Odak Kontrol√º
            checkFocus();

            requestAnimationFrame(gameLoop);
        }

        function checkFocus() {
            // Odak alanƒ± ekranƒ±n %40'ƒ±nda (CSS top: 40%)
            const screenH = window.innerHeight;
            const focusCenter = screenH * 0.4; 
            const focusH = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--focus-height'));
            const zoneTop = focusCenter - (focusH/2);
            const zoneBottom = focusCenter + (focusH/2);

            // Optimizasyon: Sadece g√∂r√ºn√ºr kelimeleri tara
            // Basit d√∂ng√º (modern tarayƒ±cƒ±lar i√ßin yeterince hƒ±zlƒ±)
            for (let w of state.words) {
                const rect = w.el.getBoundingClientRect(); // Bu biraz pahalƒ±dƒ±r ama V26'da kabul edilebilir
                
                // Kelime odak alanƒ± i√ßinde mi?
                const center = rect.top + (rect.height/2);
                if (center > zoneTop && center < zoneBottom) {
                    w.el.classList.add('in-focus');
                } else {
                    w.el.classList.remove('in-focus');
                }
            }
        }

        // === 5. CONTROLS ===
        function resetPosition() {
            state.currentY = 0;
            state.targetY = 0;
            state.scrollSpeed = 0;
            state.isPlaying = false;
            updateHud();
            // T√ºm aktif sƒ±nƒ±flarƒ± temizle
            document.querySelectorAll('.word.active').forEach(el => el.classList.remove('active'));
        }

        function togglePlay() {
            if(state.isVoiceMode) toggleVoiceMode(); // Sesliyse manuele ge√ß
            state.isPlaying = !state.isPlaying;
            if(state.isPlaying && state.scrollSpeed === 0) state.scrollSpeed = 1.5;
            updateHud();
        }

        function changeSpeed(delta) {
            if(state.isVoiceMode) return;
            state.scrollSpeed += delta;
            state.isPlaying = state.scrollSpeed !== 0;
            // Manuel modda targetY'yi currentY ile e≈üle ki zƒ±plama olmasƒ±n
            state.targetY = state.currentY; 
            updateHud();
        }

        function updatePadding() {
            // Ba≈ülangƒ±√ßta ilk satƒ±rƒ± odak alanƒ±na getirmek i√ßin padding hesapla
            const h = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--focus-height'));
            const screenH = window.innerHeight;
            const paddingTop = (screenH * 0.4) - (h/2) + 20; // %40'a hizala
            contentDiv.style.paddingTop = `${paddingTop}px`;
        }

        function setProp(name, val, labelId) {
            document.documentElement.style.setProperty(name, val);
            document.getElementById(labelId).innerText = val;
            if(name === '--focus-height') updatePadding();
        }

        function toggleMirror() {
            state.isMirrored = !state.isMirrored;
            contentDiv.className = state.isMirrored ? 'mirror-x' : '';
            document.getElementById('btn-mirror').style.backgroundColor = state.isMirrored ? '#F59E0B' : '';
            document.getElementById('btn-mirror').style.color = state.isMirrored ? '#000' : '';
        }

        function updateHud() {
            const hud = document.getElementById('hud-status');
            const hudSpeed = document.getElementById('hud-speed');
            const icon = document.getElementById('icon-play');
            
            if(state.isVoiceMode) {
                hud.innerText = "SESLƒ∞ AKI≈û";
                hud.style.color = "#F59E0B";
                hudSpeed.innerText = "AUTO";
            } else {
                if(state.isPlaying) {
                    hud.innerText = "AKIYOR";
                    hud.style.color = "#fff";
                    hudSpeed.innerText = "HIZ: " + state.scrollSpeed.toFixed(1);
                    icon.innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>'; // Pause icon
                } else {
                    hud.innerText = "DURAKLATILDI";
                    hud.style.color = "#555";
                    hudSpeed.innerText = "HIZ: 0";
                    icon.innerHTML = '<path d="M8 5v14l11-7z"/>'; // Play icon
                }
            }
        }

        // === 6. VOICE LOGIC (V26 ENGINE) ===
        function toggleVoiceMode() {
            if(!state.recognition) initSpeech();
            
            state.isVoiceMode = !state.isVoiceMode;
            if(state.isVoiceMode) {
                state.isPlaying = false;
                try { state.recognition.start(); } catch(e){}
                document.getElementById('btn-mic').classList.add('bg-red-600', 'animate-pulse');
                // Hedefi mevcut konuma e≈üitle
                state.targetY = state.currentY;
            } else {
                state.recognition.stop();
                document.getElementById('btn-mic').classList.remove('bg-red-600', 'animate-pulse');
            }
            updateHud();
        }

        function initSpeech() {
            if (!('webkitSpeechRecognition' in window)) return alert("Chrome gerekli.");
            state.recognition = new webkitSpeechRecognition();
            state.recognition.continuous = true;
            state.recognition.interimResults = true;
            state.recognition.lang = 'tr-TR';
            
            state.recognition.onresult = (e) => {
                let transcript = '';
                for (let i = e.resultIndex; i < e.results.length; ++i) transcript += e.results[i][0].transcript;
                matchVoice(transcript.toLowerCase().trim());
            };
            state.recognition.onend = () => { if(state.isVoiceMode) try{state.recognition.start()}catch(e){} };
        }

        function matchVoice(text) {
            if(!state.isVoiceMode) return;
            const words = text.split(/\s+/);
            const lastWord = words[words.length - 1];
            if(!lastWord || lastWord.length < 2) return;

            // Search Strategy: Current index +/- range
            // √áok uzaklara bakma (Anti-Jump)
            const currentIdx = state.words.findIndex(w => w.el.classList.contains('active'));
            const start = Math.max(0, currentIdx - 5);
            const end = Math.min(state.words.length, Math.max(0, currentIdx) + 30); // ƒ∞leriye bak

            for(let i = start; i < end; i++) {
                if(state.words[i].clean === lastWord) {
                    activateWord(i);
                    break;
                }
            }
        }

        function activateWord(index) {
            document.querySelectorAll('.word.active').forEach(el => el.classList.remove('active'));
            const w = state.words[index];
            if(w) {
                w.el.classList.add('active');
                
                // HEDEF BELƒ∞RLEME
                // Bu kelimenin contentDiv i√ßindeki 'offsetTop' deƒüeri bizim gitmemiz gereken Y deƒüeridir.
                // Ama ekranƒ±n ortasƒ±na (daha doƒürusu odak bandƒ±na) gelmesi i√ßin bir ofset d√º≈ümeliyiz.
                // Odak Bandƒ± Top = 40vh (CSS'den biliyoruz)
                // Ama content zaten 40vh padding ile ba≈ülƒ±yor.
                // Basit mantƒ±k: Target = Element.offsetTop
                
                state.targetY = w.el.offsetTop;
            }
        }

        // === 7. EVENTS ===
        window.addEventListener('keydown', (e) => {
            if(overlay.style.display === 'none') return;
            
            // Focus Height (+/-)
            if(e.key === '+' || e.code === 'NumpadAdd') {
                const val = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--focus-height')) + 20;
                setProp('--focus-height', val + 'px', 'val-focus');
            }
            if(e.key === '-' || e.code === 'NumpadSubtract') {
                const val = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--focus-height')) - 20;
                setProp('--focus-height', val + 'px', 'val-focus');
            }

            // Speed
            if(e.code === 'ArrowDown' || e.code === 'KeyS') changeSpeed(0.5);
            if(e.code === 'ArrowUp' || e.code === 'KeyW') changeSpeed(-0.5);
            
            // Actions
            if(e.code === 'Space') { e.preventDefault(); toggleVoiceMode(); }
            if(e.code === 'Enter') { e.preventDefault(); togglePlay(); }
            if(e.code === 'Escape') exitPrompter();
        });

        window.addEventListener('wheel', (e) => {
            if(overlay.style.display === 'none' || state.isVoiceMode) return;
            const delta = e.deltaY > 0 ? 0.3 : -0.3;
            changeSpeed(delta);
        });

    </script>
</body>
</html>
